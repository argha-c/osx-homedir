#!/usr/bin/env bash

set -e

cd ~/

git submodule update --init --recursive

if [ ! -d ~/workspace/sprout-wrap ]
then
  git clone git@github.com:scottmuc/sprout-wrap ~/workspace/sprout-wrap
fi

soloist_log=/tmp/soloist.log
~/workspace/sprout-wrap/runsoloist | tee "${soloist_log}"

if grep -q Restart "${soloist_log}"
then
  echo Soloist has signalled that a restart is necessary. Reboot your
  echo machine and run this again to continue.
  exit 1
fi

if [ ! -x /usr/local/bin/brew ]
then
  /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
else
  brew update || true
fi

brew bundle

